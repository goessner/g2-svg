/**
 * @fileoverview g2.svg.js
 * @author Stefan Goessner (c) 2015/16
 * @license MIT License
 */
if(typeof module==="object"&&module.require)g2=module.require("../../g2/g2");g2.Svg={create:function(){var t=Object.create(this.prototype);t.constructor.apply(t,arguments);return t},prototype:{constructor:function(t){this.ctx=t;this.name="$"+g2.Svg.instances++ +"_";this.content={svg:"",head:"",body:"",open:"body"};this.outerTransform=false;this.openGroups=[];this.path=false;this.useReg=[]},get width(){return"innerHTML"in this.ctx?this.ctx.getAttribute("data-width"):this.ctx.width},get height(){return"innerHTML"in this.ctx?this.ctx.getAttribute("data-height"):this.ctx.height},get str(){return this.content[this.content.open]},set str(t){this.content[this.content.open]=t},toString:function(){var t=this.content.svg;if(this.content.head)t+="<defs>\n"+this.content.head+"</defs>\n";t+=this.content.body+"</svg>\n";return t},applyStyle:function(t,s,i){for(var e in t){var r=t[e];if(typeof r==="string"&&r[0]==="@")r=s.getAttr(r.substr(1));if(!i)s.setAttr(e,r);if(g2.State.svg.set[e])g2.State.svg.set[e].call(this,r,s)}}},instances:0};g2.ifc.svg=function(t){return Object.getPrototypeOf(t)===g2.Svg.prototype||"innerHTML"in t||typeof t==="object"&&"height"in t&&"width"in t};g2.context.svg=function(t){return Object.getPrototypeOf(t)===g2.Svg.prototype?t:g2.Svg.create(t)};g2.prototype.exe.pre.svg=function(t){if(g2.exeStack++===0){var s=t.state,i=s.trf;this.g2=t;this.content.open="svg";this.str='<svg width="'+this.width+'" height="'+this.height+'" fill="transparent" stroke="black"';this.str+=' font-family="'+s.get("fof")+'" font-style="'+s.get("fos")+'" font-size="'+s.get("foz")+'" font-weight="'+s.get("fow")+'">\n';this.content.open="body";if(s.cartesian){this.str+='<g transform="matrix('+[i.scl,0,0,-i.scl,i.x+.5,this.height-i.y+.5]+')">\n';this.outerTransform=true}else if(i.x!==0||i.y!==0||i.scl!==1){this.str+='<g transform="matrix('+[i.scl,0,0,i.scl,i.x+.5,i.y+.5]+')">\n';this.outerTransform=true}s.pre(this)}else{this.content.open="head";this.str+='<g id="'+this.currentGroupName+'">\n';this.openGroups.push("group")}};g2.prototype.exe.post.svg=function(){if(--g2.exeStack===0){this.g2.state.post();while(this.openGroups.pop())this.str+="</g>\n";if(this.outerTransform)this.str+="</g>\n";if("innerHTML"in this.ctx)this.ctx.innerHTML=this.toString();else this.ctx.svg=this.toString()}else{while(this.openGroups.pop()!=="group")this.str+="</g>\n";this.str+="</g>\n";this.content.open="body"}};g2.prototype.p.svg=function t(){this.path=""};g2.prototype.m.svg=function s(t,i){this.path+="M"+t+","+i};g2.prototype.l.svg=function i(t,s){this.path+="L"+t+","+s};g2.prototype.q.svg=function e(t,s,i,r){this.path+="Q"+t+","+s+","+i+","+r};g2.prototype.c.svg=function r(t,s,i,e,n,h){this.path+="C"+t+","+s+","+i+","+e+","+n+","+h};g2.prototype.a.svg=function n(t,s,i,e,r,h){var o=t+i*Math.cos(r),a=s+i*Math.sin(r),g=h?e-r:r-e;this.path+="A"+i+","+i+",0,"+(Math.abs(g)>Math.PI?1:0)+","+(h?0:1)+","+o+","+a};g2.prototype.z.svg=function h(t,s,i,e,r,n){this.path+="Z"};g2.prototype.stroke.svg=function o(t,s){if(s)this.path=s;if(this.path){this.str+="<path";if(t)this.g2.state.save().add(t);this.str+=' fill="transparent" d="'+this.path+'"/>\n';if(t)this.g2.state.restore()}this.path=false};g2.prototype.fill.svg=function a(t,s){if(s)this.path=s;if(this.path){this.str+="<path";if(t)this.g2.state.save().add(t);this.str+=' stroke="none" d="'+this.path+'"/>\n';if(t)this.g2.state.restore()}this.path=false};g2.prototype.drw.svg=function g(t,s){if(s)this.path=s;if(this.path){this.str+="<path";if(t)this.g2.state.save().add(t);this.str+=' d="'+this.path+'"/>\n';if(t)this.g2.state.restore()}this.path=false};g2.prototype.txt.svg=function f(t,s,i,e,r){var n=this.g2.state;this.str+='<text stroke="none"';if(r)this.g2.state.save().add(r);if(!(r&&"foc"in r)&&n.get("foc")!==n.get("fill"))this.str+=' fill="'+n.get("foc")+'"';if(n.get("tval"))g2.State.svg.tval.call(this,n.get("tval"));if(n.cartesian||e){var h=e?Math.sin(e):0,o=e?Math.cos(e):1;this.str+=n.cartesian?' transform="matrix('+[o,h,h,-o,s||0,i||0]+')"':' transform="matrix('+[o,h,-h,o,s||0,i||0]+')"'}else this.str+=' x="'+s+'" y="'+i+'"';this.str+=">"+t+"</text>\n";if(r)n.restore()};g2.prototype.img.svg=function c(t,s,i,e,r){e=e||t.width;r=r||t.height;this.str+='<image xlink:href="'+t.src+'" width="'+e+'" height="'+r+'"';this.str+=this.g2.state.cartesian?' transform="matrix('+[1,0,0,-1,s,i+r]+')"':' x="'+s+'" y="'+i+'"';this.str+="></image>\n"};g2.prototype.lin.svg=function p(t,s,i,e,r){this.str+='<line x1="'+t+'" y1="'+s+'" x2="'+i+'" y2="'+e+'"';if(r)this.g2.state.save().add(r);this.str+="/>\n";if(r)this.g2.state.restore()};g2.prototype.rec.svg=function u(t,s,i,e,r){this.str+='<rect x="'+t+'" y="'+s+'" width="'+i+'" height="'+e+'"';if(r)this.g2.state.save().add(r);this.str+="/>\n";if(r)this.g2.state.restore()};g2.prototype.cir.svg=function l(t,s,i,e){this.str+='<circle cx="'+t+'" cy="'+s+'" r="'+i+'"';if(e)this.g2.state.save().add(e);this.str+="/>\n";if(e)this.g2.state.restore()};g2.prototype.arc.svg=function d(t,s,i,e,r,n){this.str+='<path d="M'+(t+Math.cos(e)*i)+","+(s+Math.sin(e)*i)+"A"+i+","+i+",0,"+ +(Math.abs(r)>Math.PI)+","+ +(Math.sign(r)>0)+","+(t+Math.cos(e+r)*i)+","+(s+Math.sin(e+r)*i)+'"';if(n)this.g2.state.save().add(n);this.str+="/>\n";if(n)this.g2.state.restore()};g2.prototype.ply.svg=function v(t,s,i,e){var r,n=0,h=s==="split",o="";i=i||g2.prototype.ply.itr;r=i(t,n++);if(!r.done){o+="M"+r.x+","+r.y;while(!(r=i(t,n++)).done)o+=(h?n%2?"M":"L":" ")+r.x+","+r.y;if(s&&!h)o+="Z"}this.str+="<path";if(e)this.g2.state.save().add(e);this.str+=' d="'+o+'"/>\n';if(e)this.g2.state.restore()};g2.prototype.beg.svg=function y(t){this.g2.state.save();this.openGroups.push("beg");this.str+="<g";if(t){this.g2.state.add(t)}this.str+=">\n"};g2.prototype.end.svg=function x(){while(this.openGroups.pop()!=="beg")this.str+="</g>\n";this.str+="</g>\n";this.g2.state.restore()};g2.prototype.clr.svg=function m(){};g2.prototype.grid.svg=function b(t,s){var i=this.g2.state,e=i.trf,r=this.width,n=this.height,h=i.trf0,o=h.scl,a=s||g2.prototype.grid.getSize(i,e?o:1),g=e.x?e.x%a-a:0,f=e.y?e.y%a-a:0;this.str+='<path stroke="'+(t||"#ccc")+'" stroke-width="1"';this.str+=i.cartesian?' transform="matrix('+[1/o,0,0,-1/o,-h.x/o+.5,(n-h.y)/o-.5]+')"':' transform="matrix('+[1/o,0,0,1/o,-h.x/o+.5,-h.y/o-.5]+')"';this.str+=' d="';for(var c=g,p=r+1;c<p;c+=a)this.str+="M"+c+",0"+"L"+c+","+n;for(var u=f,l=n+1;u<l;u+=a)this.str+="M0,"+u+"L"+r+","+u;this.str+='"/>\n'};g2.prototype.use.svg=function w(t,s){var i=this.g2,e=this.useReg.indexOf(t),r=g2.symbolNameOf(t);if(e<0){e=this.useReg.push(t)-1;this.currentGroupName=r||this.name+e;i.state.save();i.exe(this,t);i.state.restore()}i.state.save();this.str+='<use xlink:href="#'+(r||this.name+e)+'"';if(s)i.state.add(s);this.str+="/>\n";i.state.restore()};g2.prototype.style.svg=function M(t){this.openGroups.push("style");this.str+="<g";this.g2.state.add(t);this.str+=">\n"};g2.State.svg={fs:function(t){t=t.indexOf&&t.indexOf("hatch(")===0?g2.State.svg.hatch.call(this,t.substring(6,t.indexOf(")",7)).split(",")):t;this.str+=' fill="'+t+'"'},ls:function(t){t=t.indexOf&&t.indexOf("hatch(")===0?g2.State.svg.hatch.call(this,t.substring(6,t.indexOf(")",7)).split(",")):t;this.str+=' stroke="'+t+'"'},lw:function(t,s){this.str+=' stroke-width="'+t/(s.get("lwnosc")?s.trf.scl:1)+'"'},lc:function(t){this.str+=' stroke-linecap="'+t+'"'},lj:function(t){this.str+=' stroke-linejoin="'+t+'"'},lo:function(t){this.str+=' stroke-dashoffset="'+t+'"'},ld:function(t,s){var i=s.get("lwnosc")?s.current.scl:1;if(!t.length)this.str+=' stroke-dasharray="none"';else if(i!==1){var e=s.get("lw")*i,r=[];for(var n=0,h=t.length;n<h;n++)r.push(t[n]/e);this.str+=' stroke-dasharray="'+r+'"'}else this.str+=' stroke-dasharray="'+t+'"'},ml:function(t){this.str+=' stroke-miterlimit="'+t+'"'},sh:function(t,s){this.str+=' style="filter:drop-shadow('+(t[0]||5)+"px "+(t[1]||5)+"px "+(t[2]||5)+"px "+(t[3]||"rgba(0,0,0,0.5)")+'"'},foc:function(t){this.str+=' fill="'+t+'"'},fos:function(t){this.str+=' font-style="'+t+'"'},fow:function(t){this.str+=' font-weight="'+t+'"'},foz:function(t){this.str+=' font-size="'+t+'"'},fof:function(t){this.str+=' font-family="'+t+'"'},thal:function(t){var s={left:"start",center:"middle",right:"end"};this.str+=' text-anchor="'+(s[t]||t)+'"'},tval:function(t){var s={top:"hanging",bottom:"ideographic"};this.str+=' dominant-baseline="'+(s[t]||t)+'"'},trf:function(t){var s=t.scl||1,i=s*(t.w?Math.sin(t.w):0),e=s*(t.w?Math.cos(t.w):1);this.str+=' transform="matrix('+[e,i,-i,e,t.x||0,t.y||0]+')"'},matrix:function(t){this.str+=' transform="matrix('+t+')"'},hatch:function k(t){var s=this.useReg.indexOf(t.toString());if(s<0){var i=+t[3]||10,e=(i+1)*.5;s=this.useReg.push(t.toString())-1;this.content.open="head";this.str+='<pattern id="'+(this.name+s)+'"'+' width="'+i+'"'+' height="'+i+'"'+' patternUnits="userSpaceOnUse">\n';this.str+='<path d="M'+e+",0.5L"+(i+.5)+","+e+"M0.5,"+e+"L"+e+","+(i+.5)+'"'+'stroke="'+(t[0]||"black")+'" stroke-linecap="square"/>\n';this.str+="</pattern>\n";this.content.open="body"}return"url(#"+(this.name+s)+")"}};